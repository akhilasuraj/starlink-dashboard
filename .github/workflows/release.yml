name: Create Release

on:
  push:
    tags:
      - "v*.*.*"

permissions:
  contents: write

jobs:
  release:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate changelog
        id: changelog
        uses: mikepenz/release-changelog-builder-action@v4
        with:
          configuration: |
            {
              "categories": [
                {
                  "title": "## üöÄ Features",
                  "labels": ["feature", "enhancement"]
                },
                {
                  "title": "## üêõ Bug Fixes",
                  "labels": ["bug", "fix"]
                },
                {
                  "title": "## üìù Documentation",
                  "labels": ["documentation"]
                },
                {
                  "title": "## üé® UI/UX",
                  "labels": ["ui", "ux", "design"]
                },
                {
                  "title": "## üîß Maintenance",
                  "labels": ["maintenance", "chore"]
                },
                {
                  "title": "## üì¶ Other Changes",
                  "labels": []
                }
              ],
              "template": "#{{CHANGELOG}}\n\n**Full Changelog**: #{{RELEASE_DIFF}}",
              "pr_template": "- #{{TITLE}} (#{{NUMBER}})",
              "empty_template": "- No changes",
              "label_extractor": [
                {
                  "pattern": "^(build|chore|ci|docs|feat|feature|fix|perf|refactor|revert|style|test)(\\(.+\\))?:",
                  "target": "$1"
                }
              ],
              "duplicate_filter": {
                "pattern": "\\[full changelog\\]",
                "on_property": "body",
                "method": "match"
              },
              "transformers": [
                {
                  "pattern": "^(feat|feature):",
                  "target": "feature"
                },
                {
                  "pattern": "^fix:",
                  "target": "bug"
                },
                {
                  "pattern": "^(ui|style|design):",
                  "target": "ui"
                },
                {
                  "pattern": "^(docs|documentation):",
                  "target": "documentation"
                },
                {
                  "pattern": "^(chore|build|ci):",
                  "target": "maintenance"
                }
              ]
            }
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          body: |
            # Starlink Dashboard ${{ github.ref_name }}

            ## What's Changed
            ${{ steps.changelog.outputs.changelog }}

            ## Installation

            ### Windows
            1. Download `Starlink-Dashboard-Setup.exe` from the assets below
            2. Run the installer
            3. The application will start automatically on system startup

            ### From Source
            ```bash
            git clone https://github.com/akhilasuraj/starlink-dashboard.git
            cd starlink-dashboard
            npm install
            pip install -r requirements.txt
            npm start
            ```

            ---

            **Note:** Requires Python 3.7+ and an active Starlink connection.
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
